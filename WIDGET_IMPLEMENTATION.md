# ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå®Ÿè£…å®Œäº†ã‚¬ã‚¤ãƒ‰

## ğŸ‰ å®Ÿè£…å†…å®¹

Y!mobile Monitorã‚¢ãƒ—ãƒªã«ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼

### å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½

1. **Androidã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆAppWidgetï¼‰**
   - ãƒ›ãƒ¼ãƒ ç”»é¢ã«ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨é‡ã‚’è¡¨ç¤º
   - ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ä»˜ãä½¿ç”¨ç‡è¡¨ç¤º
   - ã‚¿ãƒƒãƒ—ã§ã‚¢ãƒ—ãƒªèµ·å‹•
   - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰è‡ªå‹•æ›´æ–°ï¼ˆ15åˆ†é–“éš”ï¼‰

2. **iOSã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆWidgetKitï¼‰**
   - iOS 14ä»¥é™å¯¾å¿œ
   - Small/Mediumã‚µã‚¤ã‚ºå¯¾å¿œ
   - SwiftUIå®Ÿè£…
   - è‡ªå‹•ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æ›´æ–°

3. **å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**
   - Android: SharedPreferencesï¼ˆAsyncStorageçµŒç”±ï¼‰
   - iOS: App Groupsï¼ˆUserDefaultsï¼‰

4. **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°**
   - Android: AlarmManager
   - iOS: WidgetKit Timeline

5. **React Native Bridge**
   - ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆåˆ¶å¾¡
   - ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ 

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
plugins/
â”œâ”€â”€ withAndroidWidget.js      # Expo Config Plugin (Android)
â””â”€â”€ withIOSWidget.js           # Expo Config Plugin (iOS)

android/
â”œâ”€â”€ widget/
â”‚   â”œâ”€â”€ YmobileDataWidgetProvider.java
â”‚   â”œâ”€â”€ WidgetUpdateService.java
â”‚   â”œâ”€â”€ WidgetBridgeModule.java
â”‚   â””â”€â”€ WidgetBridgePackage.java
â””â”€â”€ res/
    â”œâ”€â”€ xml/ymobile_data_widget_info.xml
    â”œâ”€â”€ layout/widget_layout.xml
    â””â”€â”€ drawable/widget_background.xml

ios/
â””â”€â”€ YmobileDataWidget/
    â”œâ”€â”€ YmobileDataWidget.swift
    â”œâ”€â”€ WidgetBridge.swift
    â”œâ”€â”€ WidgetBridge.m
    â””â”€â”€ Info.plist

lib/
â”œâ”€â”€ native-widget-bridge.ts    # React Native Bridge
â””â”€â”€ widget-manager.ts           # æ›´æ–°æ¸ˆã¿ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–é€£æºï¼‰
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pnpm install
```

### 2. ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆ

Expoã®ãƒ—ãƒªãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ï¼š

```bash
npx expo prebuild
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
- `android/` ã¨ `ios/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”Ÿæˆ
- Config Pluginã‚’é©ç”¨
- ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®

### 3. Androidå›ºæœ‰ã®è¨­å®š

#### MainApplication.javaã«WidgetBridgePackageã‚’è¿½åŠ 

`android/app/src/main/java/.../MainApplication.java`ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```java
import space.manus.y.mobile.monitor.app.t20251231050125.widget.WidgetBridgePackage;

@Override
protected List<ReactPackage> getPackages() {
  List<ReactPackage> packages = new PackageList(this).getPackages();
  // WidgetBridgePackageã‚’è¿½åŠ 
  packages.add(new WidgetBridgePackage());
  return packages;
}
```

### 4. iOSå›ºæœ‰ã®è¨­å®š

#### Xcodeã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆæ‹¡å¼µã‚’è¿½åŠ 

1. Xcodeã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãï¼š
   ```bash
   open ios/YmobileMonitor.xcworkspace
   ```

2. File â†’ New â†’ Target â†’ Widget Extension ã‚’é¸æŠ

3. Product Name: `YmobileDataWidget`

4. ä½œæˆã•ã‚ŒãŸ`YmobileDataWidget`ãƒ•ã‚©ãƒ«ãƒ€ã«ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ï¼š
   - `ios/YmobileDataWidget/YmobileDataWidget.swift`
   - `ios/YmobileDataWidget/Info.plist`

5. Signing & Capabilitiesã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
   - App Groups: `group.space.manus.y.mobile.monitor.app.t20251231050125`

6. ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã«ã‚‚App Groupsã‚’è¿½åŠ ï¼ˆåŒã˜IDï¼‰

7. `WidgetBridge.swift`ã¨`WidgetBridge.m`ã‚’ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è¿½åŠ 

### 5. ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ

#### Android

```bash
pnpm android
```

ã¾ãŸã¯

```bash
npx expo run:android
```

#### iOS

```bash
pnpm ios
```

ã¾ãŸã¯

```bash
npx expo run:ios
```

## ğŸ“± ä½¿ã„æ–¹

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®è¿½åŠ æ–¹æ³•

#### Android
1. ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’é•·æŠ¼ã—
2. ã€Œã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã€ã‚’é¸æŠ
3. ã€ŒY!mobile ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨é‡ã€ã‚’æ¢ã™
4. ãƒ›ãƒ¼ãƒ ç”»é¢ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—

#### iOS
1. ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’é•·æŠ¼ã—
2. å·¦ä¸Šã®ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
3. ã€ŒY!mobile ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨é‡ã€ã‚’æ¤œç´¢
4. ã‚µã‚¤ã‚ºã‚’é¸æŠã—ã¦ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¿½åŠ 

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®æ›´æ–°

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ï¼š
- ã‚¢ãƒ—ãƒªã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—/æ›´æ–°ã—ãŸã¨ã
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§15åˆ†ã”ã¨ï¼ˆè‡ªå‹•ï¼‰
- ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ã‚¿ãƒƒãƒ—ã—ãŸã¨ã

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Androidã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„

1. ã‚¢ãƒ—ãƒªã‚’ä¸€åº¦ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. `npx expo prebuild --clean` ã‚’å®Ÿè¡Œ
3. `android/` ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤ã—ã¦å†åº¦ `npx expo prebuild`

### iOSã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„

1. Xcodeã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒ¼ãƒ³ï¼ˆProduct â†’ Clean Build Folderï¼‰
2. App Groupsã®è¨­å®šã‚’ç¢ºèª
3. Widget Extensionã®Bundle IDãŒæ­£ã—ã„ã‹ç¢ºèª
   - ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª: `space.manus.y.mobile.monitor.app.t20251231050125`
   - ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ: `space.manus.y.mobile.monitor.app.t20251231050125.YmobileDataWidget`

### ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œãªã„

1. ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. ãƒ­ã‚°ç”»é¢ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
3. ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šç”»é¢ã§æ›´æ–°é–“éš”ã‚’ç¢ºèª

## ğŸ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´

#### Android
`android/res/layout/widget_layout.xml`ã‚’ç·¨é›†

#### iOS
`ios/YmobileDataWidget/YmobileDataWidget.swift`ã®SwiftUIã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†

### æ›´æ–°é–“éš”ã®å¤‰æ›´

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯15åˆ†ã§ã™ãŒã€ã‚¢ãƒ—ãƒªã®ã€Œã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šã€ç”»é¢ã‹ã‚‰å¤‰æ›´å¯èƒ½ã§ã™ã€‚

## ğŸ“š æŠ€è¡“è©³ç´°

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
ã‚¢ãƒ—ãƒª (React Native)
  â†“ ãƒ‡ãƒ¼ã‚¿å–å¾—
YmobileFetcher
  â†“
WidgetManager.setWidgetData()
  â†“
NativeWidgetBridge.updateWidgetData()
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Android       â”‚      iOS        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SharedPrefs     â”‚ UserDefaults    â”‚
â”‚ (AsyncStorage)  â”‚ (App Groups)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Broadcast       â”‚ WidgetCenter    â”‚
â”‚ Intent          â”‚ .reloadTimeline â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Widget Provider â”‚ WidgetKit       â”‚
â”‚ .onUpdate()     â”‚ Timeline Entry  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¡¨ç¤º
```

### ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°ã®ä»•çµ„ã¿

#### Android
- `AlarmManager.setInexactRepeating()`ã§å®šæœŸå®Ÿè¡Œ
- ãƒãƒƒãƒ†ãƒªãƒ¼æœ€é©åŒ–ã‚’è€ƒæ…®ã—ãŸã€Œä¸æ­£ç¢ºãªã€é–“éš”
- `WidgetUpdateService`ã§æ›´æ–°å‡¦ç†

#### iOS
- WidgetKitã®`Timeline`ã§æ¬¡å›æ›´æ–°æ™‚åˆ»ã‚’æŒ‡å®š
- OSãŒé©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ›´æ–°
- ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã«å¿œã˜ã¦èª¿æ•´ã•ã‚Œã‚‹

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- èªè¨¼æƒ…å ±ã¯`expo-secure-store`ã§æš—å·åŒ–ä¿å­˜
- ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ã¯ä½¿ç”¨é‡ãƒ‡ãƒ¼ã‚¿ã®ã¿å…±æœ‰ï¼ˆèªè¨¼æƒ…å ±ã¯å…±æœ‰ã—ãªã„ï¼‰
- App Groups/SharedPreferencesã¯ã‚¢ãƒ—ãƒªå°‚ç”¨ã®é ˜åŸŸ

## ğŸ“ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

- [ ] ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚µã‚¤ã‚ºã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- [ ] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [ ] ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆiOS 17+ï¼‰
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ï¼ˆä½¿ç”¨é‡ãŒé–¾å€¤ã‚’è¶…ãˆãŸã‚‰ï¼‰
- [ ] è¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œ

## ğŸ†˜ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š
1. ãƒ­ã‚°ç”»é¢ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
2. `WIDGET_SETUP.md`ã‚’å‚ç…§
3. GitHubã®Issuesã§å ±å‘Š

---

å®Ÿè£…å®Œäº†æ—¥: 2026å¹´1æœˆ11æ—¥
